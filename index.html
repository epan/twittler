<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>
    <script>

      $(document).ready(function(){
        var $body = $('body');
        $body.html('');

        // Create structure for toggling content
        ($body).append('<div class="home"></div>');
        ($body).append('<div class="user-timeline"></div>');

        var index = streams.home.length - 1;
        while(index >= 0){
          var tweet = streams.home[index];
          $(renderTweet(tweet)).appendTo('.home');
          index -= 1;
        }

        $('a').on('click', function(event) {
          event.preventDefault();
        });

        $('.home').on('click', 'a', renderUserTimeline);
        $('.user-timeline').on('click', 'a', notify);

        function renderUserTimeline() {
          $('.user-timeline').html('');
          var username = $(this).closest('.tweet').data('username');
          var index = streams.users[username].length - 1;
          while (index >= 0) {
            var tweet = streams.users[username][index];
            $(renderTweet(tweet)).prependTo('.user-timeline');
            index -= 1;
          }
          $('<a href="#" class="back">Back to home</a>').prependTo('.user-timeline');
        }

        function renderTweet(tweet) {
          var $tweet = $.parseHTML('<div class="tweet" data-username="' + tweet.user + '"></div>');
          var $tweetHeader = $.parseHTML('<div class="tweet-header"><a href="#">@' + tweet.user + '</a><span>' + tweet.created_at + '</span></div>');
          var $tweetBody = $.parseHTML('<p>' + tweet.message + '</p>');

          $($tweetHeader).appendTo($tweet);
          $($tweetBody).appendTo($tweet);
          return $tweet;
        }

        function notify() {
          alert('clicked');
        }
      });
    </script>
  </body>
</html>
